<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>2048</title>

  <link href="style/main.css" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="favicon.ico">
</head>
<body>
  <div id="two-oh-container">
    <div class="heading">
      <h1 class="title">2048</h1>
      <div class="scores-container">
        <div class="score-container">0</div>
        <div class="best-container">0</div>
      </div>
    </div>

    <div class="above-game">
      <p class="game-intro">Join the numbers and get to the <strong>2048 tile!</strong></p>
      <br /> <br />
      <a class="restart-button button">New Game</a>
      <!--a id="toggle-animation" class="button">Toggle Animation</a-->
      <a id="reload-ai" class="button">Reload AI</a>
      <a id="step-ai" class="button">Step AI</a>
      <a id="autorun-ai" class="button">Autorun</a>

    </div>

    <div class="game-container" tabindex="0">
      <div class="game-message">
        <p></p>
        <div class="lower">
	        <a class="keep-playing-button">Keep going</a>
          <a class="retry-button">Try again</a>
        </div>
      </div>

      <div class="grid-container">
        <div class="grid-row">
          <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div>
        </div>
      </div>

      <div class="tile-container">

      </div>
    </div>

    <p class="game-explanation">
      <strong class="important">How to play:</strong> Select the grid, then use your <strong>arrow keys</strong> to move the tiles. When two tiles with the same number touch, they <strong>merge into one!</strong>
    </p>
    <hr>
    <p class="game-explanation">
      <strong class="important">Writing an AI:</strong> The function <tt>next_move</tt> will be called every turn with the game board as the first argument. Since we run your code in a web worker, you cannot call <tt>console.log</tt>; hence, we provide it as the second argument.
      <br /> <br />
      After editing, you must click reload AI to save your changes.
    </p>
    <hr>
    <p>
    Created by <a href="www.xuanji.li">Li Xuanji</a>. Original game is <a href="http://gabrielecirulli.com" target="_blank">2048 by Gabriele Cirulli.</a>
    </p>
  </div>
  <div id="ai-container">
  
    <h1>console</h1>
    <div id="ai-output">
    </div>

    <form>
    <h1>Write your AI here!</h1>
    <textarea id="ai-code">
function random_direction() {
  var r = Math.random();
  if (r &lt; 0.25) {
    return 'left';
  } else if (r &lt; 0.5) {
    return 'right';
  } else if (r &lt; 0.75) {
    return 'up';
  } else {
    return 'down';
  }
}

function next_move(grid, console_log) {
  if (grid.cells[0][0]) {
    console_log(grid.cells[0][0].value);
  }
  
  return random_direction();
}
    
    </textarea>
    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="js/bind_polyfill.js"></script>
  <script src="js/classlist_polyfill.js"></script>
  <script src="js/animframe_polyfill.js"></script>
  <script src="js/keyboard_input_manager.js"></script>
  <script src="js/html_actuator.js"></script>
  <script src="js/grid.js"></script>
  <script src="js/tile.js"></script>
  <script src="js/local_storage_manager.js"></script>
  <script src="js/game_manager.js"></script>
  <script src="js/application.js"></script>

  <script src="../isicp/web-worker-interpreter/deps/codemirror/lib/codemirror.js"></script>
  <script src="../isicp/web-worker-interpreter/deps/codemirror/mode/javascript/javascript.js"></script>
  <link rel="stylesheet" type="text/css" href="../isicp/web-worker-interpreter/deps/codemirror/lib/codemirror.css" />


<script>

var ai_worker = new Worker("js/execute_AI.js");
var editor = CodeMirror.fromTextArea($("#ai-code")[0]);
var intervalID = null;


$("#toggle-animation").click(function() {
  $('body').toggleClass('notransition');      
});

ai_worker.addEventListener("message", function (e) {
  var response = e.data;
  if (response.debug) {
    console.log(response.debug);
    $("<pre>", {
      text: response.debug,
      'class': "output-debug"
    }).appendTo($("#ai-output"));
  }
  if (response.move) {
    $("<pre>", {
      text: "moved " + response.move,
      'class': "output-move"
    }).appendTo($("#ai-output"));
    if (response.move == 'left') {
      gm.move(3);
    } else if (response.move == 'right') {
      gm.move(1);
    } else if (response.move == 'up') {
      gm.move(0);
    } else if (response.move == 'down') {
      gm.move(2);
    }
  }
  $("#ai-output").scrollTop($("#ai-output")[0].scrollHeight);
}, false);

$("#step-ai").click(function() {
  ai_worker.postMessage({
    command: 'turn',
    grid: gm.grid.serialize()
  });
});

$("#reload-ai").click(function() {
  ai_worker.postMessage({
    command: 'reload',
    source_code: editor.getValue(),
  });
});

$("#autorun-ai").click(function() {
  if (intervalID == null) {
    intervalID = window.setInterval(function() {
      $("#step-ai").click();
    }, 200);
  } else {
    window.clearInterval(intervalID);
    intervalID = null;
  }
});

$("#reload-ai").click();

</script>

<a href="https://github.com/zodiac/2048" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>

</body>
</html>
